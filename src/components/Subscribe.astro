---
type Interest = "blog" | "courses";

type Props = {
  title?: string;
  blurb?: string;
  defaultInterests?: Interest[];
  showCheckboxes?: boolean;
  compact?: boolean; // nice for footer
};

const {
  title = "Get updates",
  blurb = "Occasional emails when something worth reading drops.",
  defaultInterests = ["blog"],
  showCheckboxes = false,
  compact = false,
} = Astro.props;

const checked = (v: Interest) => defaultInterests.includes(v);
---

<section class={compact ? "rounded-2xl border border-neutral-200 bg-white p-4" : "rounded-2xl border border-neutral-200 bg-white p-6"}>
  <div class="space-y-1">
    <h2 class={compact ? "text-base font-semibold text-neutral-900" : "text-lg font-semibold text-neutral-900"}>
      {title}
    </h2>
    <p class="text-sm text-neutral-600">
      {blurb}
    </p>
  </div>

  <form method="POST" action="/api/subscribe" enctype="application/x-www-form-urlencoded" class="mt-4 space-y-4">
    <div class="space-y-1">
      <label for="email" class="text-sm font-medium text-neutral-900">Email</label>
      <input
        id="email"
        type="email"
        name="email"
        required
        autocomplete="email"
        placeholder="you@example.com"
        class="w-full rounded-xl border border-neutral-300 bg-white px-4 py-3 text-sm text-neutral-900 placeholder:text-neutral-400 shadow-sm focus:border-neutral-900 focus:outline-none focus:ring-2 focus:ring-neutral-900/20"
      />
    </div>

    {showCheckboxes ? (
      <fieldset class="rounded-xl border border-neutral-200 bg-neutral-50 p-4">
        <legend class="text-sm font-medium text-neutral-900">What should I send you?</legend>

        <div class="mt-3 space-y-2">
          <label class="flex items-start gap-3 text-sm text-neutral-700">
            <input
              type="checkbox"
              name="interests"
              value="blog"
              checked={checked("blog")}
              class="mt-0.5 h-4 w-4 rounded border-neutral-300 text-neutral-900 focus:ring-neutral-900"
            />
            <span>
              <span class="font-medium text-neutral-900">Blog updates</span>
              <span class="block text-neutral-600">New posts and essays.</span>
            </span>
          </label>

          <label class="flex items-start gap-3 text-sm text-neutral-700">
            <input
              type="checkbox"
              name="interests"
              value="courses"
              checked={checked("courses")}
              class="mt-0.5 h-4 w-4 rounded border-neutral-300 text-neutral-900 focus:ring-neutral-900"
            />
            <span>
              <span class="font-medium text-neutral-900">Course / Scroll updates</span>
              <span class="block text-neutral-600">When structured content ships.</span>
            </span>
          </label>
        </div>
      </fieldset>
    ) : (
      <>
        {defaultInterests.map((tag) => (
          <input type="hidden" name="interests" value={tag} />
        ))}
      </>
    )}

    <div class={compact ? "flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between" : "flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"}>
      <button
        type="submit"
        class="inline-flex w-full items-center justify-center rounded-full bg-neutral-900 px-6 py-3 text-sm font-semibold text-white shadow-sm transition hover:bg-black focus:outline-none focus:ring-2 focus:ring-neutral-900/30 sm:w-auto"
      >
        Get updates
      </button>

      <p class="text-xs text-neutral-500">
        No spam. Unsubscribe anytime.
      </p>
    </div>
  </form>
</section>
